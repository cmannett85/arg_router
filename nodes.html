<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>arg_router: Nodes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">arg_router
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">C++ command line argument parsing and routing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Nodes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#nodes_parameter_organising">Parameter Organising</a></li>
<li class="level1"><a href="#nodes_pre_parse">Pre-Parse</a></li>
<li class="level1"><a href="#nodes_parse">Parse</a></li>
</ul>
</div>
<div class="textblock"><p>Types that derive from <a class="el" href="classarg__router_1_1tree__node.html">tree_node</a> form the nodes of the parse tree.</p>
<h1><a class="anchor" id="nodes_parameter_organising"></a>
Parameter Organising</h1>
<p>The first task <a class="el" href="classarg__router_1_1tree__node.html">tree_node</a> has to do is organise the constructor parameters.</p><ul>
<li>Policies are used to derive from, and are therefore used in the inheritance declaration</li>
<li><a class="el" href="classarg__router_1_1tree__node.html">tree_node</a> derived types are children and are moved into an internal tuple to hold them</li>
<li>Anything else causes a <code>static_assert</code> failure</li>
</ul>
<p>Splitting out other <a class="el" href="classarg__router_1_1tree__node.html">tree_node</a> derived types has a further complexity due to <a class="el" href="classarg__router_1_1list.html">list</a>, which will need flattening first.</p>
<h1><a class="anchor" id="nodes_pre_parse"></a>
Pre-Parse</h1>
<p>Every node needs pre-parse functionality because it is what the parent uses to determine if a set of tokens are for a particular child node. For a leaf node, the method performs these operations:</p><ol type="1">
<li>The entire set of unprocessed tokens and the parents of a node are passed in</li>
<li>A copy of the tokens and a temporary target are passed to each of the pre-parse phase supporting policies in priority order. Which then performs their operations on the input tokens. If the policies are adamant that the leading token(s) is not for this node, it will exit early - but not if an error occurs! Errors are saved for later</li>
<li>If all passes, then the last check is for the name (if it has one)</li>
<li>At this stage we know that the leading token(s) is for this node, so any error that was created by the policies can now be thrown</li>
<li>If no error occured then we can move the processed tokens, the ones the policies have determined are for this node (usually using <a class="el" href="classarg__router_1_1policy_1_1min__max__count__t.html">policy::min_max_count_t</a>), into the <a class="el" href="classarg__router_1_1parsing_1_1parse__target.html">parsing::parse_target</a> and return it</li>
</ol>
<p>A mode-like node implements this method very differently, because its job is to collect the <a class="el" href="classarg__router_1_1parsing_1_1parse__target.html">parsing::parse_target</a> results of all of its children rather than directly processing the tokens itself.</p>
<h1><a class="anchor" id="nodes_parse"></a>
Parse</h1>
<p>Every <a class="el" href="classarg__router_1_1tree__node.html">tree_node</a> derived type also needs to provide a parse function, which as the name suggests, processes the tokens (if any) in the given <a class="el" href="classarg__router_1_1parsing_1_1parse__target.html">parsing::parse_target</a> in order to produce a value that represents the tokens in some way.</p>
<p>It's important to note that the parse method is not called directly, the <a class="el" href="classarg__router_1_1parsing_1_1parse__target.html">parsing::parse_target</a> returned from the pre-parse is a type erasing function object type. When it is created it creates a closure around the target node and its parents, so when it is executed it calls the target node's parse method passing itself and the parents into it.</p>
<p>Let's look at what a typical node like <a class="el" href="classarg__router_1_1arg__t.html">arg_t</a> does:</p><ol type="1">
<li>Take the first token from the <a class="el" href="classarg__router_1_1parsing_1_1parse__target.html">parsing::parse_target</a>, this is guaranteed to be there because <a class="el" href="classarg__router_1_1arg__t.html">arg_t</a> has a <a class="el" href="namespacearg__router_1_1policy.html#aad881925b6e3abed579787e83350a734">policy::fixed_count</a> of 1. Then parse it using a parse-phase implementing policy if present, otherwise the global parser</li>
<li>Pass the result to any validation-phase implementing policies</li>
<li>If there is a routing phase policy, that call it with the parsed result</li>
<li>Return the parsed value to the caller</li>
</ol>
<p>There are two exits for the node, if the node is top-level then once parsing is complete we can exit to the library user's code with the result via the routing policy, as it's the only value expected to be parsed from the command line. However, often the node is the child of a mode-like type (e.g. <a class="el" href="classarg__router_1_1mode__t.html">mode_t</a>) which is building up a results tuple from the parsed tokens, in that case we return the value to the mode.</p>
<p>It's important to note that every node needs this method, even if they don't parse a value off the command line e.g. <a class="el" href="classarg__router_1_1flag__t.html">flag_t</a> which does this:</p><ol type="1">
<li>Create a <code>true</code> result</li>
<li>If there is a routing phase policy, that call it with the result</li>
<li>Return the result to the caller</li>
</ol>
<p>I.e. there is no parsing as the presence of a flag indicates a positive value. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
